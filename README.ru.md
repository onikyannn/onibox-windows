# Onibox for Windows

GUI-обертка над `sing-box` на WinUI 3.

![Onibox screenshot](screenshot.png)

## Мотивация

Доступные клиенты либо не закрывали нужные функции, либо были перегружены интерфейсом.
Нужен был простой и понятный клиент, которым смогут пользоваться даже неподготовленные пользователи.

## Сценарий использования

1. Хостите полный конфиг `sing-box` (например, на своем веб-сервере или GitHub).
2. Передаете пользователю установщик и ссылку на подписку.
3. Пользователь устанавливает Onibox.
4. Вставляет ссылку в поле `Конфигурация`.
5. Нажимает `Обновить`.
6. Нажимает `Подключить`.

## Возможности

1. Загрузка конфигурации по `http://` и `https://`.
2. Использование локального файла конфигурации (вместо URL можно указать путь к файлу).
3. Поддержка `onibox://` deep link:
   - `onibox://import/<url>`
   - `onibox://import?url=<url>`
4. Basic Auth для URL-конфигов:
   - логин/пароль запрашиваются в диалоге внутри приложения;
   - учетные данные запоминаются в Windows Credential Manager.
5. Режимы работы `Proxy` и `TUN`, переключаются в GUI.
6. В режиме `Proxy` приложение автоматически включает системный прокси по `mixed` inbound из конфига и возвращает прежние настройки при отключении/выходе.
7. Трей-иконка с быстрыми действиями: подключить/отключить, обновить конфиг, показать окно, выход.
8. Закрытие окна не завершает приложение: оно сворачивается в трей.
9. Автозапуск при старте Windows (через Task Scheduler) с запуском в трее.
10. Логи приложения и `sing-box`: `%AppData%\Onibox\logs`.

## Требования к конфигу

1. Для режима `Proxy` нужен inbound типа `mixed` с корректным `listen_port`.
2. Для режима `TUN` нужен inbound типа `tun`.
3. При запуске Onibox формирует runtime-конфиг только с выбранным inbound.

Шаблон конфига предложен в репозитории (`config-template.json`).

## Ядро

Программа поставляется с `sing-box extended`:
[shtorm-7/sing-box-extended](https://github.com/shtorm-7/sing-box-extended)

Это форк оригинального `sing-box` с поддержкой `xhttp`.

## Сборка

Требуется `.NET SDK 10.x` и Visual Studio Build Tools.
Скрипт `build.ps1` сам скачивает `sing-box.exe` из `shtorm-7/sing-box-extended`.

Сборка приложения:

```powershell
.\build.ps1 -a x64
# или
.\build.ps1 -a arm64
```

Сборка инсталлятора (скрипт Inno Setup `Onibox.iss`):

```powershell
ISCC /DMyAppArch=x64 /DMyAppPublishDir="<путь-к-publish>" /DMyAppOutputBaseFilename=OniboxSetup-x64 .\Onibox.iss
```
